{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap f9e2b0a87ea207f16a9e","webpack:///./src/History.ts","webpack:///./src/PathUtils.ts","webpack:///(webpack)/buildin/global.js","webpack:///./src/index.ts","webpack:///./src/LocationUtils.ts","webpack:///D:/workspace/web/my-router/node_modules/resolve-pathname/index.js","webpack:///./src/DOMUtils.ts","webpack:///./node_modules/timers-browserify/main.js","webpack:///./node_modules/setimmediate/setImmediate.js","webpack:///./node_modules/process/browser.js","webpack:///./src/Deferred.ts"],"names":["Object","defineProperty","exports","value","LocationUtils_1","require","PathUtils_1","DOMUtils_1","Deferred_1","MY_ROUTER_HISTORY_GOBACK_INIT","MY_ROUTER_HISTORY_WINDOW_INIT","locationKey","Symbol","baseHistoryState","push","replace","goback","reload","MyHistory","_config","_window","window","_state","assign","type","hashChange","_stateStack","_notBusyDef","_flag","onBeforeChange","onChange","_win","Error","gobackName","root","insertRoot","_hashchangeHandler","bind","_initHistory","now","_gobackState","_pathToState","undefined","state","history","sessionStorage","_replaceState","canUseDOM","timeStamp","Date","initialPath","_decodePath","_getHrefToPath","initialLocationState","isGobackNextLocation","_initGoback","_push","_stackTop","location","href","unshift","_initEventListener","_switchState","Promise","resolve","then","newState","_readonlyLocation","_execCallback","event","addEventListener","removeEventListener","stateType","_this","handleCancell","result","isFalse","isFunction","console","log","nextTick","call","error","isCancelled","toReadonly","path","data","_checkData","newLocation","oldLocation","r","_replace","n","discardLoctions","needInclude","fn","length","index","_pathToLocation","findIndex","item","map","slice","reverse","_goback","_pushState","oldURL","_stateData","newURL","go","_correct","back","Deferred","promise","arg","addLeadingSlash","hashIndex","indexOf","substring","JSON","stringify","isBusy","createLocation","parse","readonlyLocation","keys","forEach","key","get","set","enumerable","tempTitle","document","title","pop","splice","Math","max","lastState","replaceState","_encodePath","pushState","hash","checkBusy","_destroyEventListener","reject","goGoBackPage","setTimeout","callback","args","apply","charAt","parsePath","pathname","search","substr","searchIndex","__export","m","p","hasOwnProperty","History_1","default","resolve_pathname_1","currentLocation","decodeURI","e","URIError","count","crateNo","_timeStamp","createElement","cb","ctx","setImmediate","MessageChannel","test","toString","channel","port","port2","port1","onmessage","postMessage","$isFinished","$resolve","$reject"],"mappings":"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ACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,0CAA0C,sBAAsB,EAAE;AAClE;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,UAAU;AACV;AACA;;AAEA,KAAK;AACL;AACA;;AAEA,KAAK;AACL;AACA;;AAEA,KAAK;AACL;AACA;;AAEA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,CAAC;;;;;;;;ACzLD;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,qCAAqC;;AAErC;AACA;AACA;;AAEA,2BAA2B;AAC3B;AACA;AACA;AACA,4BAA4B,UAAU;;;;;;;;ACvLzB;;;;;;AACbhF,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C,EAAEC,OAAO,IAAT,EAA7C;AACA;;;;;IAIM6G,Q;AACF,wBAAc;AAAA;;AAAA;;AACV;;;;AAIA,aAAKwE,WAAL,GAAmB,KAAnB;AACA;AACA,aAAKvE,OAAL,GAAe,IAAIlD,OAAJ,CAAY,UAACC,OAAD,EAAUiF,MAAV,EAAqB;AAC5C,kBAAKwC,QAAL,GAAgBzH,OAAhB;AACA,kBAAK0H,OAAL,GAAezC,MAAf;AACH,SAHc,CAAf;AAIH;;;;;AAID;;;;gCAIQI,I,EAAM;AACV,iBAAKmC,WAAL,GAAmB,IAAnB;AACA,iBAAKC,QAAL,CAAcpC,IAAd;AACH;AACD;;;;;;;+BAIOA,I,EAAM;AACT,iBAAKmC,WAAL,GAAmB,IAAnB;AACA,iBAAKE,OAAL,CAAarC,IAAb;AACH;;;4BAlBgB;AACb,mBAAO,KAAKmC,WAAZ;AACH;;;;;;AAkBLtL,QAAQ8G,QAAR,GAAmBA,QAAnB,C","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"my-router-history\"] = factory();\n\telse\n\t\troot[\"my-router-history\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap f9e2b0a87ea207f16a9e","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst LocationUtils_1 = require(\"./LocationUtils\");\r\nconst PathUtils_1 = require(\"./PathUtils\");\r\nconst DOMUtils_1 = require(\"./DOMUtils\");\r\nconst Deferred_1 = require(\"./Deferred\");\r\nconst MY_ROUTER_HISTORY_GOBACK_INIT = 'MyRouterHistory:initGoback';\r\n// 记录MyHistory在默认window上的实例数，确保constructor仅能够运行一个实例\r\nconst MY_ROUTER_HISTORY_WINDOW_INIT = 'MyRouterHistory:window';\r\nlet locationKey = Symbol('location');\r\n/**\r\n * 用于mixin的基类\r\n */\r\nlet baseHistoryState = {\r\n    push: null,\r\n    replace: null,\r\n    goback: null,\r\n    reload: null,\r\n};\r\nclass MyHistory {\r\n    constructor(_config, _window = window) {\r\n        this._config = _config;\r\n        // 当前history的状态：\r\n        // 0未初始化    history没有完成初始化的时候\r\n        // 1正常        history正常运行中\r\n        // 2修正中      当用户手动修改hash，会被视为一次用户触发的跳转。此次跳转会先退回到goback页面，再前进回跳转的页面（为了保持history在浏览器中仅有两个浏览器记录——当前页面和退回页面），这个过程我们叫修改中\r\n        // 3返回中      当用户要求跳转回退，或者正在回退\r\n        // 4销毁中      在history销毁过程中的状态。\r\n        // 5退出中      当用户要求退出到系统以外，系统会一直触发goback，直到页面刷新为止\r\n        // 6跳转中      当用户要求跳转（包括push、replace、reload）\r\n        // 7跳转中      执行生命周期中\r\n        this._state = Object.assign({}, baseHistoryState, { type: 0, hashChange() { } });\r\n        // 保存location数据的栈\r\n        this._stateStack = [];\r\n        /**\r\n         * 如果在beforeChange生命周期，出现了跳转，会在路由重新回归1的时候执行。\r\n         * 如果_notBusyDef已经存在，即使是在beforeChange生命周期（state为7）的时候，也不可以跳转\r\n         * @private\r\n         * @type {Deferred}\r\n         * @memberOf MyHistory\r\n         */\r\n        this._notBusyDef = null;\r\n        /**\r\n         * 如果在状态等于7时候，在beforeChange里面执行push、relace、goback等函数，会将这个标记为true，让beforeChange终止change\r\n         * @private\r\n         * @type {boolean}\r\n         * @memberOf MyHistory\r\n         */\r\n        this._flag = false;\r\n        this.onBeforeChange = null;\r\n        this.onChange = null;\r\n        this._win = _window;\r\n        if (this._win[MY_ROUTER_HISTORY_WINDOW_INIT]) {\r\n            // 同一时刻，在默认的window上面，不允许有两个history实例运行\r\n            throw new Error('There are already other undestroyed history instances. Please destroy them before you can create a new history instance.');\r\n        }\r\n        this._config = Object.assign({ gobackName: 'go back', root: '/', insertRoot: true }, _config);\r\n        this._hashchangeHandler = this._hashchangeHandler.bind(this);\r\n        this._initHistory();\r\n    }\r\n    get _stackTop() {\r\n        if (this._stateStack.length) {\r\n            return this._stateStack[this._stateStack.length - 1];\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n    /**\r\n     * 初始化goback的location\r\n     * goback的location有2个作用：\r\n     * 1.用于监听用户的返回事件，当用户点击地址栏的返回按钮，会退回到goback的location。由goback去处理用户注册的goback事件\r\n     * 2.当用户手动修改浏览器的location的hash时候，history会增加一条location记录，这时候myhistory会先退回到goback的location，再前进到用户输入的lactation中，这样可以清除浏览器地址栏的前进按钮\r\n     * @private\r\n     * @param {number} now      初始化时候的时间戳\r\n     * @returns {boolean}       是否是goback处于上一页。返回false表示当前就是goback页面。\r\n     * @memberOf MyHistory\r\n     */\r\n    _initGoback(now) {\r\n        // 先查看是否已经创建好了一个goback的location，因为浏览器中无法查看history对象里面保存的历史记录，所以使用history.state保存这个状态。\r\n        // state里面用于记录当前是否处于goback的下一页。\r\n        // 让goback比当前时间戳小，这样能够判断出是后退\r\n        this._gobackState = this._pathToState('/goback', undefined, 'GOBACK', now - 1);\r\n        let state = this._win.history.state;\r\n        if (state && state.type === 'GOBACK' && sessionStorage[MY_ROUTER_HISTORY_GOBACK_INIT]) {\r\n            // 如果当前页面是goback，表示goback已经初始化完成\r\n            return false;\r\n        }\r\n        else if (state && state.type === 'NORMAL' && sessionStorage[MY_ROUTER_HISTORY_GOBACK_INIT]) {\r\n            // 因为目前还处于goback页面，所有返回false\r\n            return true;\r\n        }\r\n        else {\r\n            sessionStorage[MY_ROUTER_HISTORY_GOBACK_INIT] = true;\r\n            this._replaceState(this._gobackState);\r\n            return false;\r\n        }\r\n    }\r\n    // 初始化URL\r\n    _initHistory() {\r\n        // 创建hash路由\r\n        if (!DOMUtils_1.canUseDOM) {\r\n            throw new Error('Hash history needs a DOM');\r\n        }\r\n        // 获取当前时间戳\r\n        let timeStamp = Date.now();\r\n        // 获取当前的路径，将其转换为合法路径后，\r\n        let initialPath = this._decodePath(this._getHrefToPath());\r\n        let initialLocationState = this._pathToState(initialPath, undefined, 'NORMAL', timeStamp);\r\n        // 初始化goback\r\n        let isGobackNextLocation = this._initGoback(timeStamp);\r\n        // 将当前路径压入栈中\r\n        this._push(initialLocationState, !isGobackNextLocation);\r\n        // 如果第一个节点不等于根的路径，插入根节点到栈底\r\n        if (this._config.insertRoot && this._stackTop.location.href !== this._config.root) {\r\n            this._stateStack.unshift(this._pathToState(this._config.root, undefined, 'NORMAL', timeStamp));\r\n        }\r\n        // 初始化监听器\r\n        this._initEventListener();\r\n        // 全部初始化完成，记录初始化成功\r\n        this._win[MY_ROUTER_HISTORY_WINDOW_INIT] = true;\r\n        this._switchState(1);\r\n        // 使用微队列，用于异步初始化\r\n        Promise.resolve()\r\n            .then(() => {\r\n            let newState = this._readonlyLocation(initialLocationState);\r\n            this._execCallback(this.onChange)('init', null, newState, [], [newState]);\r\n        });\r\n    }\r\n    /**\r\n     * 注册到HashChange事件的监听器。这个函数会在构造器中bind，以在addEventListener保持this不变\r\n     * @private\r\n     * @param {HashChangeEvent} event\r\n     * @memberOf MyHistory\r\n     */\r\n    _hashchangeHandler(event) {\r\n        this._state.hashChange(event);\r\n    }\r\n    _initEventListener() {\r\n        // 注册\r\n        this._win.addEventListener('hashchange', this._hashchangeHandler);\r\n    }\r\n    _destroyEventListener() {\r\n        this._win.removeEventListener('hashchange', this._hashchangeHandler);\r\n    }\r\n    /**\r\n     * 切换状态\r\n     * @private\r\n     * @param {any} stateType\r\n     * @memberOf MyHistory\r\n     */\r\n    _switchState(stateType) {\r\n        let _this = this;\r\n        // 处理beforeChange中的取消逻辑。如果用户返回false、Error、Function都视为取消跳转。其中Function会在跳转结束后自执行\r\n        let handleCancell = function (result) {\r\n            let isFalse = result === false, isFunction = typeof result === 'function';\r\n            console.log(_this._flag);\r\n            if (isFalse || isFunction || _this._flag) {\r\n                // 这里用任务队列而不用微任务队列，希望整个promise执行完再执行result\r\n                if (isFunction) {\r\n                    DOMUtils_1.nextTick(() => {\r\n                        ;\r\n                        result.call(this);\r\n                    });\r\n                }\r\n                // 抛出用户取消异常\r\n                let error = new Error('User cancelled');\r\n                error.isCancelled = true;\r\n                throw error;\r\n            }\r\n            else if (result instanceof Error) {\r\n                throw result;\r\n            }\r\n        };\r\n        // 简单原型函数名，增加压缩效率\r\n        let toReadonly = this._readonlyLocation.bind(this);\r\n        switch (stateType) {\r\n            case (1):\r\n                this._state = {\r\n                    type: 1,\r\n                    push: async (path, data) => {\r\n                        this._checkData(data);\r\n                        // 先切换到状态6，保护在跳转过程中不受其他操作影响\r\n                        this._switchState(6);\r\n                        try {\r\n                            let state = this._pathToState(path, data, 'NORMAL');\r\n                            let newLocation = toReadonly(state);\r\n                            let oldLocation = toReadonly(this._stackTop);\r\n                            this._flag = false;\r\n                            let result = await (this._execCallback(this.onBeforeChange)('push', oldLocation, newLocation, [], [newLocation]));\r\n                            // 处理取消情况\r\n                            handleCancell(result);\r\n                            this._push(state);\r\n                            // 确保跳转完成\r\n                            await new Promise(r => DOMUtils_1.nextTick(r));\r\n                            await (this._execCallback(this.onChange)('push', oldLocation, newLocation, [], [newLocation]));\r\n                            this._switchState(1);\r\n                            return this._readonlyLocation(state);\r\n                        }\r\n                        catch (e) {\r\n                            // 完成后切换状态1\r\n                            this._switchState(1);\r\n                            throw e;\r\n                        }\r\n                    },\r\n                    replace: async (path, data) => {\r\n                        this._checkData(data);\r\n                        this._switchState(6);\r\n                        try {\r\n                            let now = Date.now();\r\n                            let state = this._pathToState(path, data, 'NORMAL', now);\r\n                            let newLocation = toReadonly(state);\r\n                            let oldLocation = toReadonly(this._stackTop);\r\n                            this._flag = false;\r\n                            let result = await (this._execCallback(this.onBeforeChange)('replace', oldLocation, newLocation, [oldLocation], [newLocation]));\r\n                            // 处理取消情况\r\n                            handleCancell(result);\r\n                            this._replace(state);\r\n                            // 确保跳转完成\r\n                            await new Promise(r => DOMUtils_1.nextTick(r));\r\n                            this._switchState(1);\r\n                            await this._execCallback(this.onChange)('replace', oldLocation, newLocation, [oldLocation], [newLocation]);\r\n                            return this._readonlyLocation(state);\r\n                        }\r\n                        catch (e) {\r\n                            // 完成后切换状态1\r\n                            this._switchState(1);\r\n                            throw e;\r\n                        }\r\n                    },\r\n                    goback: async (n = 1) => {\r\n                        // 先执行生命周期\r\n                        this._switchState(3);\r\n                        try {\r\n                            // 当前页面\r\n                            let oldLocation;\r\n                            // 丢弃的页面\r\n                            let discardLoctions;\r\n                            // 退回到的页面\r\n                            let newState;\r\n                            // 新建页面\r\n                            let newLocation;\r\n                            // 是否有符合退回条件的页面，如果没有插入一条\r\n                            let needInclude = false;\r\n                            // 判断是否符合页面的条件\r\n                            let fn;\r\n                            if (typeof n === 'number') {\r\n                                // 如果退回的步数大于栈的长度，则给缓存插入一个根页面，让用户先退回到根页面\r\n                                if (n <= 0) {\r\n                                    return null;\r\n                                }\r\n                                else if (n >= this._stateStack.length) {\r\n                                    fn = () => false;\r\n                                }\r\n                                else {\r\n                                    fn = (location, index) => this._stateStack.length - index - 1 === n;\r\n                                }\r\n                            }\r\n                            else if (typeof n === 'string') {\r\n                                // 查询有没有href等于n的页面，如果没有就退回到起点，然后插入一条记录\r\n                                fn = (location) => location.href === this._pathToLocation(n).href;\r\n                            }\r\n                            else if (typeof n === 'function') {\r\n                                fn = n;\r\n                            }\r\n                            let index = this._stateStack.findIndex((item, index) => fn(toReadonly(item), index));\r\n                            oldLocation = toReadonly(this._stackTop);\r\n                            if (index === -1) {\r\n                                // 如果没有找到，就插入一条根节点进去。但是如果查询的是指定页面，就将指定页面放进去\r\n                                newState = this._pathToState(this._pathToLocation(typeof n === 'string' ? n : this._config.root), 'NORMAL', undefined);\r\n                                newLocation = toReadonly(newState);\r\n                                discardLoctions = this._stateStack.map(item => toReadonly(item));\r\n                                needInclude = true;\r\n                            }\r\n                            else {\r\n                                // 取出退回位置的state\r\n                                newState = this._stateStack[index];\r\n                                newLocation = toReadonly(newState);\r\n                                discardLoctions = this._stateStack.slice(index + 1).map(item => toReadonly(item)).reverse();\r\n                            }\r\n                            this._flag = false;\r\n                            let result = await (this._execCallback(this.onBeforeChange)('goback', oldLocation, newLocation, discardLoctions, needInclude ? [newLocation] : []));\r\n                            // 处理取消情况\r\n                            handleCancell(result);\r\n                            this._goback(discardLoctions.length, needInclude ? newState : null, false);\r\n                            // 确保跳转完成\r\n                            await new Promise(r => DOMUtils_1.nextTick(r));\r\n                            this._switchState(1);\r\n                            await (this._execCallback(this.onChange)('goback', oldLocation, newLocation, discardLoctions, needInclude ? [newLocation] : []));\r\n                            return this._readonlyLocation(newState);\r\n                        }\r\n                        catch (e) {\r\n                            // 完成后切换状态1\r\n                            this._switchState(1);\r\n                            throw e;\r\n                        }\r\n                    },\r\n                    reload: () => {\r\n                        return this._state.replace(this._stackTop.location.href);\r\n                    },\r\n                    hashChange: (event) => {\r\n                        let state = this._win.history.state;\r\n                        if (state && state.type === 'GOBACK') {\r\n                            // 用户手动退回，前进一个页面，让history的修正\r\n                            this._pushState(this._stackTop);\r\n                            this._state.goback(1);\r\n                        }\r\n                        else if (!state && this._getHrefToPath(event.oldURL) === this._stateStack[this._stateStack.length - 1].location.href) {\r\n                            // 判断是否是用户手动修改hash跳转，或者a标签切换hash。判断方法如下：\r\n                            // 1.当前history没有state，或者state不等于State变量\r\n                            // 2.oldURL等于当前_stateStack栈顶的href（即使这样也不能确定该页面是从系统页面栈顶跳转过来的，但是没有其他更好的方式）\r\n                            // 先切户到手动修正用户修改url的状态2，保留用户要跳转的url\r\n                            this._switchState(2);\r\n                            this._stateData = this._getHrefToPath(event.newURL);\r\n                            // 后退两次，退回到goback页面\r\n                            this._win.history.go(-2);\r\n                        }\r\n                        else {\r\n                            // 如果不是从栈顶的url转跳转到该状态，就无法确定返回页面就在当前页面的前面，因此触发修正\r\n                            this._correct();\r\n                            // 纠正后重新后退\r\n                            this._win.history.back();\r\n                        }\r\n                    }\r\n                };\r\n                // 重新置回1，设置_notBusyDef为resolve\r\n                if (this._notBusyDef) {\r\n                    this._notBusyDef.resolve(undefined);\r\n                    this._notBusyDef = null;\r\n                }\r\n                break;\r\n            case (2):\r\n                this._state = Object.assign({ type: 2 }, baseHistoryState, { hashChange: (event) => {\r\n                        // 对纠正的处理步骤\r\n                        // 1. 一直后退，直到后退到goback页面\r\n                        // 2. 前进到gobackNext页面，把用户给出的地址放到gobackNext页面中。\r\n                        let state = this._win.history.state;\r\n                        if (state && state.type === 'NORMAL') {\r\n                            // 如果当前处于gobackNext页面，表示上一页就是goback，则退回，这主要是为了修改ios的safari那种无法使用go(-2)的浏览器时候的处理方式\r\n                            this._win.history.back();\r\n                        }\r\n                        else if (state && state.type === 'GOBACK') {\r\n                            // 如果已经在goback页面了，则跳转到用户手输入的地址\r\n                            let now = Date.now();\r\n                            let location = this._pathToLocation(this._stateData, now);\r\n                            // 切回正在状态，这样就完成了对页面的修正\r\n                            this._switchState(1);\r\n                            this._pushState(this._stackTop);\r\n                            this._state.push(location.href);\r\n                        }\r\n                        else {\r\n                            // 在纠正的时候，如果跳转到了goback和gobackNext以外的页面，视为异常，进行异常纠正\r\n                            this._correct();\r\n                            // 纠正后重新后退\r\n                            this._win.history.back();\r\n                        }\r\n                    } });\r\n                break;\r\n            case (3):\r\n            case (6):\r\n                this._state = Object.assign({ type: stateType }, baseHistoryState, { hashChange: (event) => {\r\n                        if (!this._win.history.state && this._getHrefToPath(event.oldURL) === this._stateStack[this._stateStack.length - 1].location.href) {\r\n                            // 如果用户在此期间手动修改url，直接纠正\r\n                            this._correct();\r\n                        }\r\n                        else {\r\n                            // 用户手动退回，前进一个页面，让history的修正\r\n                            this._pushState(this._stackTop);\r\n                        }\r\n                    } });\r\n                break;\r\n            case (4):\r\n            case (5):\r\n                this._state = Object.assign({ type: stateType }, baseHistoryState, { hashChange: (event) => {\r\n                        this._win.history.back();\r\n                    } });\r\n                break;\r\n            case (7):\r\n                this._state = {\r\n                    type: stateType,\r\n                    hashChange: (event) => {\r\n                        this._win.history.back();\r\n                    },\r\n                    push: async (path, state) => {\r\n                        this._notBusyDef = new Deferred_1.Deferred;\r\n                        console.log(2222);\r\n                        this._flag = true;\r\n                        return this._notBusyDef.promise.then(() => {\r\n                            return this.push(path, state);\r\n                        });\r\n                    },\r\n                    replace: async (path, state) => {\r\n                        this._notBusyDef = new Deferred_1.Deferred;\r\n                        this._flag = true;\r\n                        return this._notBusyDef.promise.then(() => {\r\n                            return this.replace(path, state);\r\n                        });\r\n                    },\r\n                    goback: async (arg) => {\r\n                        this._notBusyDef = new Deferred_1.Deferred;\r\n                        this._flag = true;\r\n                        return this._notBusyDef.promise.then(() => {\r\n                            return this.goback(arg);\r\n                        });\r\n                    },\r\n                    reload: async () => {\r\n                        this._notBusyDef = new Deferred_1.Deferred;\r\n                        this._flag = true;\r\n                        return this._notBusyDef.promise.then(() => {\r\n                            return this.reload();\r\n                        });\r\n                    },\r\n                };\r\n                break;\r\n        }\r\n    }\r\n    /**\r\n     * 将用户给定的path转为系统显示的path\r\n     * @private\r\n     * @param {string} path         用户给定的path\r\n     * @returns {string}            系统显示的path\r\n     * @memberOf MyHistory\r\n     */\r\n    _encodePath(path) {\r\n        return PathUtils_1.addLeadingSlash(path);\r\n    }\r\n    /**\r\n     * 将系统显示的path转为用户给定的path\r\n     * @private\r\n     * @param {string} path         系统显示的path\r\n     * @returns {string}            用户给定的path\r\n     * @memberOf MyHistory\r\n     */\r\n    _decodePath(path) {\r\n        return PathUtils_1.addLeadingSlash(path);\r\n    }\r\n    // 获取hash中保存的路径。\r\n    _getHrefToPath(href = this._win.location.href) {\r\n        // We can't use window.location.hash here because it's not\r\n        // consistent across browsers - Firefox will pre-decode it!\r\n        const hashIndex = href.indexOf('#');\r\n        return hashIndex === -1 ? '' : href.substring(hashIndex + 1);\r\n    }\r\n    // 检查data，确保data可以序列化\r\n    _checkData(data) {\r\n        if (data != null) {\r\n            JSON.stringify(data);\r\n        }\r\n    }\r\n    // 检查路由是否处于可以跳转状态（state为1或7，如果处于7仅能跳转1次）\r\n    checkBusy() {\r\n        if (this.isBusy) {\r\n            let error = new Error('MyHistory busy');\r\n            error.isBusy = true;\r\n            throw error;\r\n        }\r\n    }\r\n    /**\r\n     * 将给定的path封装成一个location\r\n     * @private\r\n     * @param {string} path\r\n     * @param {number} [timeStamp=Date.now()]\r\n     * @returns\r\n     * @memberOf MyHistory\r\n     */\r\n    _pathToLocation(path, timeStamp = Date.now()) {\r\n        path = this._decodePath(path);\r\n        // 创建的location\r\n        return LocationUtils_1.createLocation(path, timeStamp + '');\r\n    }\r\n    _pathToState(path, data = null, type, timeStamp) {\r\n        let location;\r\n        if (typeof path === 'object') {\r\n            location = path;\r\n        }\r\n        else {\r\n            location = this._pathToLocation(path, timeStamp);\r\n        }\r\n        return {\r\n            location: location,\r\n            type,\r\n            timeStamp,\r\n            data: JSON.parse(JSON.stringify(data))\r\n        };\r\n    }\r\n    _readonlyLocation(state) {\r\n        let data = state.data;\r\n        let location = Object.assign({}, state.location, { state: data });\r\n        // 只读对象\r\n        let readonlyLocation = {\r\n            [locationKey]: location\r\n        };\r\n        // 通过只设置getter不设置setter实现只读。不使用freeze是因为freeze在严格模式下赋值会抛出错误。\r\n        Object.keys(location).forEach((key) => {\r\n            Object.defineProperty(readonlyLocation, key, {\r\n                get() {\r\n                    return this[locationKey][key];\r\n                },\r\n                set() {\r\n                },\r\n                enumerable: true,\r\n            });\r\n        });\r\n        return readonlyLocation;\r\n    }\r\n    async _push(state, push = false) {\r\n        if (push) {\r\n            let tempTitle = this._win.document.title;\r\n            // 修改title为gobackName，这样地址栏显示的时候会是一个给定的gobackName，而不是页面的title\r\n            this._win.document.title = this._config.gobackName;\r\n            this._pushState(state);\r\n            this._win.document.title = tempTitle;\r\n        }\r\n        else {\r\n            this._replaceState(state);\r\n        }\r\n        this._stateStack.push(state);\r\n    }\r\n    async _replace(state, push = false) {\r\n        this._stateStack.pop();\r\n        this._stateStack.push(state);\r\n        if (push) {\r\n            let tempTitle = this._win.document.title;\r\n            // 修改title为gobackName，这样地址栏显示的时候会是一个给定的gobackName，而不是页面的title\r\n            this._win.document.title = this._config.gobackName;\r\n            this._pushState(state);\r\n            this._win.document.title = tempTitle;\r\n        }\r\n        else {\r\n            this._replaceState(state);\r\n        }\r\n    }\r\n    _goback(n, state = null, push = false) {\r\n        if (n <= 0) {\r\n            return;\r\n        }\r\n        this._stateStack.splice(Math.max(0, this._stateStack.length - n));\r\n        if (state) {\r\n            this._stateStack.push(state);\r\n        }\r\n        let lastState = this._stateStack[this._stateStack.length - 1];\r\n        if (push) {\r\n            this._pushState(lastState);\r\n        }\r\n        else {\r\n            this._replaceState(lastState);\r\n        }\r\n    }\r\n    _replaceState(state) {\r\n        this._win.history.replaceState(state, null, '#' + this._encodePath(state.location.href));\r\n    }\r\n    _pushState(state) {\r\n        this._win.history.pushState(state, null, '#' + this._encodePath(state.location.href));\r\n    }\r\n    /**\r\n     * 当用处于未知页面（既不是goback页面，也不是normal页面时候），触发纠正\r\n     */\r\n    _correct() {\r\n        // 暂时先记录日志\r\n        console.error('异常', this._stateStack, this._win.history.state, location.hash);\r\n        // 初始化goback\r\n        let isGobackNextLocation = this._initGoback(this._gobackState.timeStamp);\r\n        // 初始化当前页面\r\n        this._push(this._stackTop, !isGobackNextLocation);\r\n    }\r\n    push(path, data) {\r\n        this.checkBusy();\r\n        return this._state.push(path, data);\r\n    }\r\n    replace(path, data) {\r\n        this.checkBusy();\r\n        return this._state.replace(path, data);\r\n    }\r\n    goback(n) {\r\n        this.checkBusy();\r\n        return this._state.goback(n);\r\n    }\r\n    reload() {\r\n        this.checkBusy();\r\n        return this._state.reload();\r\n    }\r\n    async destroy() {\r\n        this._destroyEventListener();\r\n        this.onBeforeChange = null;\r\n        this.onChange = null;\r\n        if (this._notBusyDef) {\r\n            let error = new Error('User cancelled');\r\n            error.isCancelled = true;\r\n            this._notBusyDef.reject(error);\r\n            this._notBusyDef = null;\r\n        }\r\n        sessionStorage[MY_ROUTER_HISTORY_GOBACK_INIT] = false;\r\n        let goGoBackPage = async () => {\r\n            if (this._win.history.state && this._win.history.state.type === 'NORMAL') {\r\n                this._win.history.back();\r\n                await new Promise(r => setTimeout(r, 50));\r\n                await goGoBackPage();\r\n            }\r\n            else if (this._win.history.state) {\r\n                this._win.history.replaceState(null, null, '#' + this._stackTop.location.href);\r\n                this._win.location.hash = '#' + this._stackTop.location.href;\r\n                await new Promise(r => setTimeout(r, 50));\r\n                await goGoBackPage();\r\n            }\r\n            else {\r\n                await new Promise(r => setTimeout(r, 50));\r\n            }\r\n        };\r\n        await goGoBackPage();\r\n        // 延时，等pushState执行完\r\n        this._stateStack = null;\r\n        this._config = null;\r\n        this._stateData = null;\r\n        this._state = null;\r\n        if (this._win === window) {\r\n            delete this._win[MY_ROUTER_HISTORY_WINDOW_INIT];\r\n        }\r\n        this._win = null;\r\n    }\r\n    get stack() {\r\n        return this._stateStack.map(state => this._readonlyLocation(state));\r\n    }\r\n    get length() {\r\n        return this._stateStack.length;\r\n    }\r\n    get isBusy() {\r\n        return (this._state.type !== 1 && this._state.type !== 7) || !!(this._notBusyDef && this._state.type === 7);\r\n    }\r\n    get location() {\r\n        return this._readonlyLocation(this._stackTop);\r\n    }\r\n    _execCallback(callback) {\r\n        if (typeof callback === 'function') {\r\n            return (async (...args) => {\r\n                let state = this._state.type;\r\n                try {\r\n                    this._switchState(7);\r\n                    let result = await callback.apply(this, args);\r\n                    this._switchState(state);\r\n                    return result;\r\n                }\r\n                catch (e) {\r\n                    this._switchState(state);\r\n                    throw e;\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            return (() => Promise.resolve());\r\n        }\r\n    }\r\n}\r\nexports.MyHistory = MyHistory;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/History.ts","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * 增加'/'到path\r\n * @export\r\n * @param {string} path\r\n * @returns {string}\r\n */\r\nfunction addLeadingSlash(path) {\r\n    return path.charAt(0) === '/' ? path : '/' + path;\r\n}\r\nexports.addLeadingSlash = addLeadingSlash;\r\n// /**\r\n//  * 移除path的根'/'\r\n//  * @export\r\n//  * @param {string} path\r\n//  * @returns {string}\r\n//  */\r\n// export function stripLeadingSlash(path: string): string {\r\n//     return path.charAt(0) === '/' ? path.substr(1) : path;\r\n// }\r\n// /**\r\n//  * 移除path最后的'/'\r\n//  * @export\r\n//  * @param {string} path\r\n//  * @returns {string}\r\n//  */\r\n// export function stripTrailingSlash(path: string): string {\r\n//     return path.charAt(path.length - 1) === '/' ? path.slice(0, -1) : path;\r\n// }\r\n/**\r\n * 将一个path转为location对象形式\r\n * @export\r\n * @param {string} path\r\n * @param {any} state\r\n * @returns {ILocation}\r\n */\r\nfunction parsePath(path) {\r\n    let pathname = path || '/';\r\n    let search = '';\r\n    let hash = '';\r\n    const hashIndex = pathname.indexOf('#');\r\n    if (hashIndex !== -1) {\r\n        hash = pathname.substr(hashIndex);\r\n        pathname = pathname.substr(0, hashIndex);\r\n    }\r\n    const searchIndex = pathname.indexOf('?');\r\n    if (searchIndex !== -1) {\r\n        search = pathname.substr(searchIndex);\r\n        pathname = pathname.substr(0, searchIndex);\r\n    }\r\n    return {\r\n        pathname,\r\n        search: search === '?' ? '' : search,\r\n        hash: hash === '#' ? '' : hash,\r\n        key: '',\r\n        get href() {\r\n            return this.pathname + this.search + this.hash;\r\n        }\r\n    };\r\n}\r\nexports.parsePath = parsePath;\r\n// /**\r\n//  * 将一个location对象转为path对象\r\n//  * @export\r\n//  * @param {ILocation} location\r\n//  * @returns {string}\r\n//  */\r\n// export function createPath(location: ILocation): string {\r\n//     const { pathname, search, hash } = location;\r\n//     let path = pathname || '/';\r\n//     if (search && search !== '?')\r\n//         path += search.charAt(0) === '?' ? search : `?${search}`;\r\n//     if (hash && hash !== '#') path += hash.charAt(0) === '#' ? hash : `#${hash}`;\r\n//     return path;\r\n// }\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/PathUtils.ts","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 2\n// module chunks = 0","\"use strict\";\r\nfunction __export(m) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n__export(require(\"./History\"));\r\nconst History_1 = require(\"./History\");\r\nexports.default = History_1.MyHistory;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.ts","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst resolve_pathname_1 = require(\"resolve-pathname\");\r\nconst PathUtils_1 = require(\"./PathUtils\");\r\n/**\r\n *\r\n * @export\r\n * @param {string | _Location} path href字符串或者location对象\r\n * @param {any} key 猜测是一个标记location的key\r\n * @param {_Location} currentLocation 当前的location对象，用于解析出相对路径\r\n * @returns\r\n */\r\nfunction createLocation(path, key = '', currentLocation = null) {\r\n    let location;\r\n    // 如果path是字符串，将其封装成location\r\n    if (typeof path === 'string') {\r\n        location = PathUtils_1.parsePath(path);\r\n    }\r\n    else {\r\n        // 如果path不是字符串，认为他是location，\r\n        // One-arg form: push(location)\r\n        location = Object.assign({}, path);\r\n        // 规范化传入的location的pathname、search、hash。如果存在这些数据，索性置为“”，反正后面会根据\r\n        if (location.pathname === undefined)\r\n            location.pathname = '';\r\n        if (location.search) {\r\n            if (location.search.charAt(0) !== '?')\r\n                location.search = '?' + location.search;\r\n        }\r\n        else {\r\n            location.search = '';\r\n        }\r\n        if (location.hash) {\r\n            if (location.hash.charAt(0) !== '#')\r\n                location.hash = '#' + location.hash;\r\n        }\r\n        else {\r\n            location.hash = '';\r\n        }\r\n    }\r\n    try {\r\n        // 将不符合URL规范的字符做URL编码。如果不能做URL编码抛出异常\r\n        location.pathname = decodeURI(location.pathname);\r\n    }\r\n    catch (e) {\r\n        if (e instanceof URIError) {\r\n            throw new URIError('Pathname \"' +\r\n                location.pathname +\r\n                '\" could not be decoded. ' +\r\n                'This is likely caused by an invalid percent-encoding.');\r\n        }\r\n        else {\r\n            throw e;\r\n        }\r\n    }\r\n    // location的key应该是自定义的内容，用于标记location使用\r\n    if (key)\r\n        location.key = key;\r\n    if (currentLocation) {\r\n        // Resolve incomplete/relative pathname relative to current location.\r\n        // 如果传入的当前的location对象，需要用其解析出先对路径\r\n        if (!location.pathname) {\r\n            location.pathname = currentLocation.pathname;\r\n        }\r\n        else if (location.pathname.charAt(0) !== '/') {\r\n            location.pathname = resolve_pathname_1.default(location.pathname, currentLocation.pathname);\r\n        }\r\n    }\r\n    else {\r\n        // When there is no prior location and pathname is empty, set it to /\r\n        // 如果没有pathname，就用根路径\r\n        if (!location.pathname) {\r\n            location.pathname = '/';\r\n        }\r\n    }\r\n    return location;\r\n}\r\nexports.createLocation = createLocation;\r\n// /**\r\n//  * 判断两个location对象是否相等。这里的key是增加的功能，用于区分两个完全一样的url\r\n//  * @export\r\n//  * @param {any} a\r\n//  * @param {any} b\r\n//  * @returns\r\n//  */\r\n// export function locationsAreEqual(a: _Location, b: _Location) {\r\n//     return a.href === b.href\r\n// }\r\nlet timeStamp;\r\nlet count = 0;\r\n/**\r\n * 创建location的ID\r\n * @export\r\n * @param {number} _timeStamp\r\n * @returns\r\n */\r\nfunction crateNo(_timeStamp) {\r\n    if (timeStamp !== _timeStamp) {\r\n        timeStamp = _timeStamp;\r\n        count = 0;\r\n    }\r\n    return timeStamp * 100 + count++;\r\n}\r\nexports.crateNo = crateNo;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/LocationUtils.ts","function isAbsolute(pathname) {\n  return pathname.charAt(0) === '/';\n}\n\n// About 1.5x faster than the two-arg version of Array#splice()\nfunction spliceOne(list, index) {\n  for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1) {\n    list[i] = list[k];\n  }\n\n  list.pop();\n}\n\n// This implementation is based heavily on node's url.parse\nfunction resolvePathname(to) {\n  var from = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n  var toParts = to && to.split('/') || [];\n  var fromParts = from && from.split('/') || [];\n\n  var isToAbs = to && isAbsolute(to);\n  var isFromAbs = from && isAbsolute(from);\n  var mustEndAbs = isToAbs || isFromAbs;\n\n  if (to && isAbsolute(to)) {\n    // to is absolute\n    fromParts = toParts;\n  } else if (toParts.length) {\n    // to is relative, drop the filename\n    fromParts.pop();\n    fromParts = fromParts.concat(toParts);\n  }\n\n  if (!fromParts.length) return '/';\n\n  var hasTrailingSlash = void 0;\n  if (fromParts.length) {\n    var last = fromParts[fromParts.length - 1];\n    hasTrailingSlash = last === '.' || last === '..' || last === '';\n  } else {\n    hasTrailingSlash = false;\n  }\n\n  var up = 0;\n  for (var i = fromParts.length; i >= 0; i--) {\n    var part = fromParts[i];\n\n    if (part === '.') {\n      spliceOne(fromParts, i);\n    } else if (part === '..') {\n      spliceOne(fromParts, i);\n      up++;\n    } else if (up) {\n      spliceOne(fromParts, i);\n      up--;\n    }\n  }\n\n  if (!mustEndAbs) for (; up--; up) {\n    fromParts.unshift('..');\n  }if (mustEndAbs && fromParts[0] !== '' && (!fromParts[0] || !isAbsolute(fromParts[0]))) fromParts.unshift('');\n\n  var result = fromParts.join('/');\n\n  if (hasTrailingSlash && result.substr(-1) !== '/') result += '/';\n\n  return result;\n}\n\nexport default resolvePathname;\n\n\n//////////////////\n// WEBPACK FOOTER\n// D:/workspace/web/my-router/node_modules/resolve-pathname/index.js\n// module id = 5\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.canUseDOM = !!(typeof window !== 'undefined' &&\r\n    window.document &&\r\n    window.document.createElement);\r\n/**\r\n * 在下一个任务队列中执行\r\n * @export\r\n * @param {Function} cb         回调函数\r\n * @param {Object} [ctx]\r\n */\r\nfunction nextTick(cb, ctx) {\r\n    let callback = () => {\r\n        if (typeof cb === 'function') {\r\n            cb.call(ctx);\r\n        }\r\n    };\r\n    if (typeof setImmediate !== 'undefined') {\r\n        setImmediate(callback);\r\n    }\r\n    else if (typeof MessageChannel !== 'undefined'\r\n        && (/native code/.test(MessageChannel.toString()) || MessageChannel.toString() === '[object MessageChannelConstructor]')) {\r\n        const channel = new MessageChannel();\r\n        const port = channel.port2;\r\n        channel.port1.onmessage = callback;\r\n        port.postMessage(1);\r\n    }\r\n    else {\r\n        setTimeout(callback, 0);\r\n    }\r\n}\r\nexports.nextTick = nextTick;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/DOMUtils.ts","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/timers-browserify/main.js\n// module id = 7\n// module chunks = 0","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 6–8\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/setimmediate/setImmediate.js\n// module id = 8\n// module chunks = 0","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/process/browser.js\n// module id = 9\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * 反转promise的异步控制的对象模型——Deferred\r\n * @returns\r\n */\r\nclass Deferred {\r\n    constructor() {\r\n        /**\r\n         * promise是否已经完成\r\n         * @type {boolean}\r\n         */\r\n        this.$isFinished = false;\r\n        //返回的参数\r\n        this.promise = new Promise((resolve, reject) => {\r\n            this.$resolve = resolve;\r\n            this.$reject = reject;\r\n        });\r\n    }\r\n    get isFinished() {\r\n        return this.$isFinished;\r\n    }\r\n    /**\r\n     * 对外暴露的接口，promise正常完成\r\n     * @param {T} args\r\n     */\r\n    resolve(args) {\r\n        this.$isFinished = true;\r\n        this.$resolve(args);\r\n    }\r\n    /**\r\n     * 对外暴露的接口，promise异常结束\r\n     * @param {any} args\r\n     */\r\n    reject(args) {\r\n        this.$isFinished = true;\r\n        this.$reject(args);\r\n    }\r\n}\r\nexports.Deferred = Deferred;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/Deferred.ts"],"sourceRoot":""}